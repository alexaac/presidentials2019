var app=function(){"use strict";const t={g1:{name:"KLAUS-WERNER IOHANNIS",color:"#2171b5"},g2:{name:"THEODOR PALEOLOGU",color:"#7fc6bc"},g3:{name:"ILIE-DAN BARNA",color:"#22ace4"},g4:{name:"HUNOR KELEMEN",color:"#aac52e"},g5:{name:"VASILICA-VIORICA DĂNCILĂ",color:"#fa8376"},g6:{name:"CĂTĂLIN-SORIN IVAN",color:"#4182e4"},g7:{name:"NINEL PEIA",color:"#2a5c70"},g8:{name:"SEBASTIAN-CONSTANTIN POPESCU",color:"#18533d"},g9:{name:"JOHN-ION BANU",color:"#345f4f"},g10:{name:"MIRCEA DIACONU",color:"#9379da"},g11:{name:"BOGDAN-DRAGOS-AURELIU MARIAN-STANOEVICI",color:"#bde67c"},g12:{name:"RAMONA-IOANA BRUYNSEELS",color:"#bf7ce6"},g13:{name:"VIOREL CATARAMĂ",color:"#7a344b"},g14:{name:"ALEXANDRU CUMPĂNAŞU",color:"#888622"}},e={g1:{name:"KLAUS-WERNER IOHANNIS",color:"#2171b5"},g2:{name:"VASILICA-VIORICA DĂNCILĂ",color:"#fa8376"}},a={},r=["counties_wgs84","counties_cart_wgs84","counties_cart_hex_10000_wgs84","counties_cart_hex_10000d_wgs84"],o=d3.scaleThreshold().domain([0,10,20,30,40,50,55,60,65,70,75,80,85,90,95,100]).range(d3.schemeReds[9]),s=d3.scaleThreshold().domain([0,10,20,30,40,50,55,60,65,70,75,80,85,90,95,100]).range(d3.schemeBlues[9]),n=d3.scaleQuantize().domain([0,100]).range(d3.schemeReds[9]),i=d3.scaleQuantize().domain([0,100]).range(d3.schemeBlues[9]),d=d3.geoAlbers().center([24.7731,45.7909]).rotate([-14,3.3,-10]).parallels([37,54]).scale(5e3),l=d3.geoPath().projection(d),c=t=>e=>Math.ceil(Math.round(e/t)*t),p=t=>t.slice(1).map((e,a)=>[t[a],e]),g=t=>t.properties.joined.rate1>t.properties.joined.rate2?"2019-11-10"===t.properties.joined.electionsDate?o(t.properties.joined.rate1):n(t.properties.joined.rate1):"2019-11-10"===t.properties.joined.electionsDate?s(t.properties.joined.rate2):i(t.properties.joined.rate2),u=d3.select("body").append("tooltip_div").attr("class","tooltip").style("opacity",0),f=t=>{u.transition().duration(200).style("opacity",.9),u.html(m(t)).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px"),d3.selectAll(".CO-"+t.properties.joined.code).attr("style","stroke: #00ffff; stroke-Config.viewport_width: 2px; fill-opacity: 0.8; cursor: pointer;")},m=t=>t.properties.joined.candidate2+" votes: "+d3.format(".2f")(t.properties.joined.rate2)+"% </br>"+t.properties.joined.candidate1+" votes: "+d3.format(".2f")(t.properties.joined.rate1)+"% </br>Electoral district: "+t.properties.joined.electoralDistrict+"</br>Total valid votes: "+t.properties.joined.totValidVotes.toLocaleString()+"</br>"+(48!==t.properties.cod_birou?"Valid votes / km²: "+t.properties.joined.vvot_sqkm+"</br>":""),h=t=>{u.transition().duration(500).style("opacity",0),d3.selectAll(".CO-"+t.properties.joined.code).attr("style","stroke: none; cursor: none;")},x=t=>(t.forEach(t=>{t.c=t.d1,t.g1=t.e1,t.g2=t.e2,t.g3=t.e3,t.g4=t.e4,t.g5=t.e5,t.g6=t.e6,t.g7=t.e7,t.g8=t.e8,t.g9=t.e9,t.g10=t.e10,t.g11=t.e11,t.g12=t.e12,t.g13=t.e13,t.g14=t.e14}),t),v=(r,o)=>{let s=d3.map();return r.forEach(r=>{let n=(r=>({code:{2014:r["Cod Birou Electoral"],"2019-11-10":r["Cod birou electoral"],"2019-11-24":r["Cod birou electoral"]},totValidVotes:{2014:r["Numărul total al voturilor valabil exprimate"],"2019-11-10":r.c,"2019-11-24":r.c},vote1:{2014:r["VICTOR-VIOREL PONTA"],"2019-11-10":r.g5,"2019-11-24":r.g2},candidate1:{2014:a.g5,"2019-11-10":t.g5.name,"2019-11-24":e.g2.name},vote2:{2014:r["KLAUS-WERNER IOHANNIS"],"2019-11-10":r.g1,"2019-11-24":r.g1},candidate2:{2014:a.g1,"2019-11-10":t.g1.name,"2019-11-24":e.g1.name},electoralDistrict:{2014:r["Nume Judet"],"2019-11-10":r["Județ"],"2019-11-24":r["Județ"]},rate1:{2014:r["VICTOR-VIOREL PONTA"]/r["Numărul total al voturilor valabil exprimate"]*100,"2019-11-10":r.g5/r.c*100,"2019-11-24":r.g2/r.c*100},rate1Color:{2014:c(5)(r["VICTOR-VIOREL PONTA"]/r["Numărul total al voturilor valabil exprimate"]*100),"2019-11-10":c(5)(r.g5/r.c*100),"2019-11-24":c(5)(r.g2/r.c*100)},rate2:{2014:r["KLAUS-WERNER IOHANNIS"]/r["Numărul total al voturilor valabil exprimate"]*100,"2019-11-10":r.g1/r.c*100,"2019-11-24":r.g1/r.c*100},rate2Color:{2014:c(5)(r["KLAUS-WERNER IOHANNIS"]/r["Numărul total al voturilor valabil exprimate"]*100),"2019-11-10":c(5)(r.g1/r.c*100),"2019-11-24":c(5)(r.g1/r.c*100)}}))(r);s.set(n.code[o],{code:n.code[o],totValidVotes:n.totValidVotes[o],vote1:n.vote1[o],candidate1:n.candidate1[o],vote2:n.vote2[o],candidate2:n.candidate2[o],electoralDistrict:n.electoralDistrict[o],rate1:n.rate1[o],rate1Color:n.rate1Color[o],rate2:n.rate2[o],rate2Color:n.rate2Color[o]})}),s},y=(a,o,s)=>{const n=(t=>{let e=[];return t.reduce((t,a)=>{const r=["c","g1","g2","g3","g4","g5","g6","g7","g8","g9","g10","g11","g12","g13","g14"],o=a["Cod birou electoral"];return t[o]||(t[o]={"Cod birou electoral":o,"Județ":a["Județ"]},r.forEach(e=>{t[o][e]=0}),e.push(t[o])),r.forEach(e=>{t[o][e]+=Number(a[e])}),t},{}),e})(o),i=((a,r)=>{const o=[];let s=[];(s="2019-11-10"===r?["g1","g2","g3","g4","g5","g6","g7","g8","g9","g10","g11","g12","g13","g14"]:["g1","g2"]).forEach(s=>{const n=a.reduce((t,e)=>(t[e[s]]||(t[e["Județ"]]=e[s]),t),{}),i=Object.keys(n).map(t=>n[t]).reduce((t,e)=>t+e,0);n.total=i||0,n.candidateId=s;const d="2019-11-10"===r?t[s].name:e[s].name;o[d]=n});let n=Object.keys(o),i=0;return n.forEach(t=>i+=o[t].total||0),n.forEach(t=>{o[t].totalCountry=i,o[t].rateCountry=(o[t].total/i*100).toFixed(3)}),o})(n,s),d={formattedData:((t,e,a)=>{const o=v(e,a);return r.forEach(e=>{t.objects[e].geometries=t.objects[e].geometries.filter(t=>t),t.objects[e].geometries.forEach(t=>{if(void 0===o.get(t.properties.cod_birou))t.properties.joined={code:t.cod_birou,candidate1:"",candidate2:"",districtAbbr:"",electoralDistrict:"",rate1:0,rate1Color:0,rate2:0,rate2Color:0,totValidVotes:0,totValidVotes_rate:0,vote1:0,vote2:0,vvot_sqkm:0,electionsDate:a};else try{return t.properties.joined=o.get(t.properties.cod_birou),t.properties.joined.code=t.properties.cod_birou,t.properties.joined.districtAbbr=t.properties.abbr,t.properties.joined.vvot_sqkm=Math.ceil(t.properties.joined.totValidVotes/t.properties.area_sqkm),t.properties.joined.electionsDate=a,t}catch(t){console.log(t)}})}),t})(a,n,s),votesByCounties:n,votesByCandidates:i,electionsDate:s};return(t,e,a)=>t(d,e,a)},b=(t,e,a)=>{let r=t.formattedData;r=topojson.feature(r,{type:"GeometryCollection",geometries:r.objects[e].geometries});const o=a.append("g"),s=d,n=d3.geoScaleBar().units("miles").left(.45),i=o.append("g").attr("transform","translate(-110,660)"),l=d3.geoScaleBar().left(.45).distance(100),c=o.append("g").attr("transform","translate(-110,700)"),p=()=>{s.fitSize([620,660],r),n.fitSize([620,660],r).projection(s),i.call(n),l.fitSize([620,660],r).projection(s),c.call(l)};p(),window.onresize=(t=>p())},A=(t,e,a)=>{const r=t.formattedData,i=t.electionsDate,d=t.votesByCandidates;let l=topojson.feature(r,r.objects[e]).features;const c=Object.keys(l).map(t=>l[t]),g=c.reduce((t,e)=>t.properties.joined.rate1Color<e.properties.joined.rate1Color?t:e,c[0]),u=c.reduce((t,e)=>t.properties.joined.rate1Color>e.properties.joined.rate1Color?t:e,c[0]),f=c.reduce((t,e)=>t.properties.joined.rate2Color<e.properties.joined.rate2Color?t:e,c[0]),m=c.reduce((t,e)=>t.properties.joined.rate2Color>e.properties.joined.rate2Color?t:e,c[0]),h=a.append("g").attr("transform","translate(290, 80)"),x=a.append("g").attr("transform","translate(0, 80)"),v=d3.scaleLinear().domain([g.properties.joined.rate1Color,u.properties.joined.rate1Color]).rangeRound([10,300]),y=d3.scaleLinear().domain([m.properties.joined.rate2Color,f.properties.joined.rate2Color]).rangeRound([10,300]);h.selectAll("rect").data(p(v.ticks(10))).enter().append("rect").attr("height",20).attr("x",t=>v(t[0])).attr("width",t=>v(t[1])-v(t[0])).style("fill",t=>"2019-11-10"===i?o(t[0]):n(t[0])),x.selectAll("rect").data(p(y.ticks(10))).enter().append("rect").attr("height",20).attr("x",t=>y(t[0])).attr("width",t=>y(t[1])-y(t[0])).style("fill",t=>s(t[0]));const b=d3.axisBottom(v).ticks(3).tickSize(30);h.append("g").attr("class","x axis").call(b);const A=d3.axisBottom(y).ticks(3).tickSize(30);x.append("g").attr("class","x axis").call(A);const j=void 0!==u.properties.joined.code?`${u.properties.joined.candidate1} (${d3.format(",.2f")(d[u.properties.joined.candidate1].rateCountry)} %)`:"",_=void 0!==u.properties.joined.code?`${m.properties.joined.candidate2} (${d3.format(",.2f")(d[m.properties.joined.candidate2].rateCountry)} %)`:"",$=void 0!==u.properties.joined.code?`${m.properties.joined.candidate1} ${d3.format(",.0f")(d[m.properties.joined.candidate1].total)}`:"",V=void 0!==u.properties.joined.code?`${m.properties.joined.candidate2} ${d3.format(",.0f")(d[m.properties.joined.candidate2].total)}`:"",C=void 0!==u.properties.joined.code?`TOTAL ${d3.format(",.0f")(d[m.properties.joined.candidate2].totalCountry)}`:"";h.append("text").attr("class","caption").attr("x",v.range()[0]+30).attr("y",-6).attr("class","bubble-label").attr("text-anchor","start").attr("font-weight","bold").text(`${j}`),x.append("text").attr("class","caption").attr("x",y.range()[0]).attr("y",-6).attr("class","bubble-label").attr("text-anchor","start").attr("font-weight","bold").text(`${_}`),x.append("text").attr("class","caption").attr("x",y.range()[0]).attr("y",86).attr("class","bubble-label").attr("text-anchor","start").attr("font-weight","bold").text(`${V}`),x.append("text").attr("class","caption").attr("x",y.range()[0]).attr("y",106).attr("class","bubble-label").attr("text-anchor","start").attr("font-weight","bold").text(`${$}`),x.append("text").attr("class","caption").attr("x",y.range()[0]).attr("y",126).attr("class","bubble-label").attr("text-anchor","start").attr("font-weight","bold").text(`${C}`)},j=(t,e,a)=>{const r=t.formattedData;let o=topojson.feature(r,r.objects[e]).features;const s=Object.keys(o).map(t=>o[t]);o=s.sort((t,e)=>e.properties.joined.totValidVotes-t.properties.joined.totValidVotes);const n=5,i=10,d=a.append("g").attr("transform",`translate(${n},${i})`),c=d3.scaleLinear().domain([0,d3.max(o,t=>t.properties.joined.totValidVotes)]).range([0,450]),p=d3.scaleBand().domain(o.map(t=>t.properties.joined.districtAbbr)).rangeRound([78,660]).padding(.1),u=d3.axisTop(c).ticks(5).tickSize(5);d.append("g").attr("class","x-axis").attr("transform",t=>"translate(55,70)").call(u).selectAll("text").attr("y","-5");const m=d3.axisLeft(p).ticks(10).tickSize(0);d.append("g").attr("class","y-axis").attr("transform",t=>"translate(60,0)").call(m);const x=d.selectAll("g.bar").data(o).enter().append("g").attr("class","bar").attr("transform",t=>`translate(60,${p(t.properties.joined.districtAbbr)})`);x.append("rect").attr("width",t=>c(t.properties.joined.totValidVotes)).attr("height",p.bandwidth()).attr("class","bar-county").attr("class",t=>`CO-${t.properties.joined.code}`).attr("fill",t=>g(t)).attr("d",l).on("mouseover",t=>f(t)).on("mouseout",t=>h(t)),x.append("text").attr("class","value").attr("x",t=>c(t.properties.joined.totValidVotes)).attr("y",p.bandwidth()/2).attr("dx",3).attr("dy",".35em").attr("text-anchor","begin").text(t=>d3.format(",.0f")(t.properties.joined.totValidVotes))},_=(t,e,a)=>{t.votesByCounties;const r=topojson.feature(t.formattedData,t.formattedData.objects.counties_wgs84).features;let o=[];r.forEach(t=>o.push({name:t.properties.joined.electoralDistrict,value:t.properties.joined.totValidVotes,properties:t.properties}));const s={name:"Districts",children:o},n=d3.format(",d"),i=(t=>d3.treemap().tile(d3.treemapResquarify).size([620,660]).padding(1).round(!0)(d3.hierarchy(t).eachBefore(t=>{t.data.id=(t.parent?t.parent.data.id+".":"")+t.data.name}).sum(t=>t.value).sort((t,e)=>e.value-t.value)))(s),d=a.selectAll("g").data(i.leaves()).join("g").attr("transform",t=>`translate(${t.x0},${t.y0})`);d.append("rect").attr("id",t=>t.data.id).attr("class","districts").attr("fill",t=>{for(;t.depth>1;)t=t.parent;return g(t.data)}).attr("fill-opacity",.6).attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).on("mouseover",function(t){u.transition().duration(200).style("opacity",.9),u.html(`${t.ancestors().reverse().map(t=>t.data.name).join("/")}</br>${n(t.value)} votes`).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){u.transition().duration(500).style("opacity",0)}),d.append("clipPath").attr("id",t=>`clip-${t.data.id}`).append("use").attr("xlink:href",t=>`#${t.data.id}`),d.append("text").attr("font-size","10px").attr("clip-path",t=>`url(#clip-${t.data.id})`).selectAll("tspan").data(t=>t.data.name.split(/(?=[A-Z][^A-Z])/g).concat(n(t.value))).join("tspan").attr("x",3).attr("y",(t,e,a)=>`${.3*(e===a.length-1)+1.1+.9*e}em`).attr("fill-opacity",(t,e,a)=>e===a.length-1?.7:null).text(t=>t)},$=(a,r,o)=>{const s=a.votesByCandidates,n=Math.min(620,660)/2-40;let i=Object.keys(s).map(t=>({candidateId:s[t].candidateId,name:t,value:s[t].total,percent:s[t].rateCountry}));i=i.filter(t=>0!==t.value);const d=o.append("g").attr("transform","translate(310,330)"),l=d3.pie().sort(null).value(t=>t.value),c=d3.arc().outerRadius(.5*n).innerRadius(.8*n);d.selectAll("path").data(l(i)).enter().append("g").on("mouseover",function(t){let e=d3.select(this).append("g").attr("class","text-group");e.append("text").attr("class","name-text").text(`${t.data.name}`).attr("text-anchor","middle").attr("dy","-1.2em"),e.append("text").attr("class","value-text").text(`${d3.format(",.0f")(t.data.value)} votes ( ${d3.format(",.2f")(+t.data.percent)} % )`).attr("text-anchor","middle").attr("dy",".6em")}).on("mouseout",function(t){d3.select(this).attr("style","stroke: none; cursor: none;").select(".text-group").remove()}).append("path").attr("d",c).attr("fill",(r,o)=>"2019-11-10"===a.electionsDate?t[r.data.candidateId].color:e[r.data.candidateId].color).on("mouseover",function(t){d3.select(this).attr("style","stroke: #00ffff; stroke-width: 2px; fill-opacity: 0.8; cursor: pointer;")}).on("mouseout",function(t){d3.select(this).attr("style","stroke: none; cursor: none;")}).each(function(t,e){this._current=e;let a=/(^.+?)L/.exec(d3.select(this).attr("d"))[1];if(a=a.replace(/,/g," "),t.endAngle>90*Math.PI/180){const t=/A(.*?)0 0 1/,e=/0 0 1 (.*?)$/;let r,o,s;if(s=/M(.*?)A/.exec(a)[1],e.exec(a))a=`M${r=e.exec(a)[1]}A${o=t.exec(a)[1]}0 0 0${s}`;else{const t=/A(.*?)0 1 1/;a=`M${r=/0 1 1 (.*?)$/.exec(a)[1]}A${o=t.exec(a)[1]}1 1 0${s}`}}o.append("path").attr("class","hiddenDonutArcs").attr("id","donutArc"+e).attr("d",a).style("fill","none")});d.selectAll(".donutText").data(l(i)).enter().append("text").attr("font-size","12px").attr("class","donutText").attr("dy",(t,e)=>t.endAngle>90*Math.PI/180?18:-11).append("textPath").attr("startOffset","50%").style("text-anchor","start").attr("xlink:href",(t,e)=>`#donutArc${e}`).text(t=>`${t.data.name} ( ${d3.format(",.2f")(+t.data.percent)} % )`)},V=t=>{const e=t.data,a=t.variable,r=t.legendText,o=t.maxAreaSize,s=d3.max(e,t=>t.properties.joined[a]),n=d3.scaleLinear().range([5,o]).domain([0,s]),i=3*o,d=2*o+10,l=t.svg.append("g").attrs({transform:t=>"translate(10,600)"}).attr("width",i).attr("height",d),c=[s,t.legendData[0],t.legendData[1]];"circle"===t.typeOfArea?l.selectAll(".legend-area").data(c).enter().append("circle").attr("class","legend-area").attr("cy",t=>n(t)+1).attr("cx",n(s)+1).attr("r",t=>n(t)):l.selectAll(".legend-area").data(c).enter().append("rect").attr("class","legend-area").attr("cy",t=>n(t)+1).attr("cx",n(s)+1).attr("width",t=>n(t)).attr("height",t=>n(t)),"circle"===t.typeOfArea?l.selectAll(".legend-dotted-line").data(c).enter().append("line").attr("class","legend-dotted-line").attr("x1",n(s)+1).attr("x2",2*n(s)+8).attr("y1",t=>2*n(t)+1).attr("y2",t=>2*n(t)+1):l.selectAll(".legend-dotted-line").data(c).enter().append("line").attr("class","legend-dotted-line").attr("x1",n(s)+1).attr("x2",n(s)+8).attr("y1",t=>n(t)).attr("y2",t=>n(t)),"circle"===t.typeOfArea?l.selectAll(".legend-number").data(c).enter().append("text").attr("class","legend-number").attr("x",2*n(s)+8).attr("y",t=>2*n(t)+5).text((t,e)=>t+(e==c.length-1?" "+r:"")):l.selectAll(".legend-number").data(c).enter().append("text").attr("class","legend-number").attr("x",n(s)+8).attr("y",t=>n(t)+5).text((t,e)=>t+(e==c.length-1?" "+r:""));return 1},C=(t,e,a)=>{const r=t.formattedData;var o=topojson.feature(r,{type:"GeometryCollection",geometries:r.objects[e].geometries});const s=d3.geoPath().projection(d.fitSize([620,660],o)),n=topojson.feature(r,r.objects[e]).features,i=a.append("g").attr("class","features").selectAll("path").data(n);i.enter().append("path").attr("fill",t=>g(t)).attr("d",s).attr("class",t=>`CO-${t.properties.joined.code}`).on("mouseover",t=>f(t)).on("mouseout",t=>h(t)),i.exit().each(function(t){this._xhr.abort()}).remove();let l=n;if("counties_cart_hex_10000_wgs84"===e){const t=topojson.feature(r,r.objects.counties_cart_hex_10000d_wgs84).features;a.append("g").attr("class","features-overlay").selectAll("path").data(t).enter().append("path").attr("fill","none").attr("d",s),l=t}a.selectAll(".feature-label").data(l).enter().append("text").attr("class","feature-label").attr("transform",t=>`translate(${s.centroid(t)})`).attr("dy",".35em").text(t=>t.properties.joined.districtAbbr),"counties_wgs84"!==e&&(e.match("counties_cart_")?V({typeOfArea:"circle",data:n,variable:"totValidVotes",maxAreaSize:55,svg:a,legendData:[3e5,1e5],legendText:"Total valid votes"}):V({typeOfArea:"square",data:n,variable:"totValidVotes",maxAreaSize:120,svg:a,legendData:[3e5,1e5],legendText:"Total valid votes"}))},R=(t,e,a)=>{const r=t.formattedData;var o=topojson.feature(r,{type:"GeometryCollection",geometries:r.objects[e].geometries});const s=d3.geoPath().projection(d.fitSize([620,660],o)),n=a.append("g"),i=d3.scaleSqrt().range([0,55]),l=d3.forceSimulation().force("collision",d3.forceCollide(t=>t.r+.35)).force("attract",d3.forceAttract().target(t=>[t.foc_x,t.foc_y])),c=n.append("g");(()=>{const t=topojson.merge(r,r.objects.counties_wgs84.geometries);c.append("path").attrs({class:"land",d:s(t)});const o=topojson.feature(r,r.objects[e]).features;o.forEach(t=>{if("Polygon"===t.geometry.type)return t.main=t;if("MultiPolygon"===t.geometry.type){const e=[];return t.geometry.coordinates.forEach(a=>{const r={};return r={coordinates:a,properties:t.properties,type:"Polygon"},r.area=d3.geoArea(r),e.push(r)}),t.main=e.reduce((t,e)=>t.area>e.area?t:e,e[0])}});V({typeOfArea:"circle",data:o,variable:"totValidVotes",maxAreaSize:55,svg:a,legendData:[3e5,1e5],legendText:"Total valid votes"}),(()=>{const t=[];o.forEach(e=>t.push({parent:"romania",country:e,properties:e.properties,totValidVotes:+e.properties.joined.totValidVotes})),i.domain([0,d3.max(t,t=>t.totValidVotes)]),t.forEach(t=>t.r=i(t.totValidVotes)),t.forEach(t=>(t.centroid=d(d3.geoCentroid(t.country.main)),t.x=t.centroid[0],t.y=t.centroid[1],t.foc_x=t.centroid[0],t.foc_y=t.centroid[1]));const e=n.selectAll(".bubble").data(t).enter().append("circle").attrs({class:t=>`bubble CO-${t.properties.joined.code}`,r:t=>t.r,fill:t=>g(t)}).on("mouseover",t=>f(t)).on("mouseout",t=>h(t)),a=n.selectAll(".feature-label").data(t).enter().append("g").attrs({class:"feature-label"});a.append("text").text(t=>t.properties.joined.districtAbbr).attrs({dy:"0.35em"}),l.nodes(t).stop();let r=0;for(let t=r=0,e=Math.ceil(Math.log(l.alphaMin())/Math.log(1-l.alphaDecay()));0<=e?r<e:r>e;t=0<=e?++r:--r)l.tick();e.attrs({transform:t=>`translate(${t.x},${t.y})`}),a.attrs({transform:t=>`translate(${t.x},${t.y})`})})()})()},S=(t,e,a)=>{const r=t.formattedData;var o=topojson.feature(r,{type:"GeometryCollection",geometries:r.objects[e].geometries});const s=d3.geoPath().projection(d.fitSize([620,660],o)),n=topojson.merge(r,r.objects.counties_wgs84.geometries);a.append("path").attrs({class:"land",d:s(n)});const i=topojson.feature(r,r.objects[e]).features,l=d3.scaleLinear().range([6,20]).domain(d3.extent(i,t=>t.properties.joined.totValidVotes)),c=d3.scaleSqrt().range([5,120]).domain(d3.extent(i,t=>t.properties.joined.totValidVotes));i.forEach(t=>{t.pos=s.centroid(t),t.area=c(t.properties.joined.totValidVotes),[t.x,t.y]=t.pos});const p=d3.forceSimulation(i).force("x",d3.forceX(t=>t.x).strength(.1)).force("y",d3.forceY(t=>t.y).strength(.1)).force("collide",()=>{for(let t=0,e=4,a=.5;t<e;++t)for(let t=0,e=i.length;t<e;++t)for(let r=i[t],o=t+1;o<e;++o){let t=i[o],e=r.x+r.vx-t.x-t.vx,s=r.y+r.vy-t.y-t.vy,n=Math.abs(e),d=Math.abs(s),l=r.area/2+t.area/2+3;n<l&&d<l&&(n>d?(n=(n-l)*(e<0?-a:a),r.vx-=n,t.vx+=n):(d=(d-l)*(s<0?-a:a),r.vy-=d,t.vy+=d))}});for(let t=0;t<120;++t)p.tick();const u=a.selectAll("g").data(i).enter().append("g").attr("transform",t=>`translate(${t.x}, ${t.y})`);u.append("rect").attr("class",t=>`bubble CO-${t.properties.joined.code}`).attr("width",t=>t.area).attr("height",t=>t.area).attr("x",t=>-t.area/2).attr("y",t=>-t.area/2).attr("fill",t=>g(t)).attr("rx",2).on("mouseover",t=>f(t)).on("mouseout",t=>h(t)),u.append("text").attr("class","feature-label").filter(t=>t.area>18).style("font-family","sans-serif").style("font-size",t=>`${l(t.properties.joined.totValidVotes)}px`).attr("text-anchor","middle").attr("dy",2).text(t=>t.properties.joined.districtAbbr);a.selectAll("rect").data(i).enter().append("rect").attr("width",t=>2*t.r).attr("height",t=>2*t.r);V({typeOfArea:"square",data:i,variable:"totValidVotes",maxAreaSize:120,svg:a,legendData:[3e5,1e5],legendText:"Total valid votes"})},w=(t,e,a)=>{const r=t.formattedData;var o=topojson.feature(r,{type:"GeometryCollection",geometries:r.objects[e].geometries});const s=d3.geoPath().projection(d.fitSize([620,660],o)),n=topojson.feature(r,r.objects[e]).features;n.forEach(t=>{t.properties.joined.totalValidVotesScale=Math.sqrt(t.properties.joined.totValidVotes/3e5),t.properties.joined.totValidVotes_rate=Math.ceil(t.properties.joined.totValidVotes/t.properties.joined.totalValidVotesScale)||0}),a.append("g").attr("class","black").selectAll("path").data(n).enter().append("path").attr("d",s),a.append("g").attr("class","land").selectAll("path").data(n).enter().append("path").attr("d",s),a.append("g").attr("class","white").selectAll("path").data(n).enter().append("path").attr("fill",t=>g(t)).attr("transform",t=>{const e=s.centroid(t),a=e[0],r=e[1];return`translate(${a},${r})`+`scale(${t.properties.joined.totalValidVotesScale||.6})`+`translate(${-a},${-r})`}).attr("d",s).attr("class",t=>`CO-${t.properties.joined.code}`).on("mouseover",t=>f(t)).on("mouseout",t=>h(t));a.selectAll(".feature-label").data(n).enter().append("text").attr("class","feature-label").attr("transform",t=>`translate(${s.centroid(t)})`).attr("dy",".35em").text(t=>t.properties.joined.districtAbbr);V({typeOfArea:"square",data:n,variable:"totValidVotes_rate",maxAreaSize:120,svg:a,legendData:[3e5,1e5],legendText:"Total valid votes"})};function N(){}function I(t){return t()}function O(){return Object.create(null)}function E(t){t.forEach(I)}function D(t){return"function"==typeof t}function M(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let L;function k(t){L=t}const T=[],B=[],P=[],z=[],U=Promise.resolve();let Y=!1;function q(t){P.push(t)}function G(){const t=new Set;do{for(;T.length;){const t=T.shift();k(t),H(t.$$)}for(;B.length;)B.pop()();for(let e=0;e<P.length;e+=1){const a=P[e];t.has(a)||(a(),t.add(a))}P.length=0}while(T.length);for(;z.length;)z.pop()();Y=!1}function H(t){null!==t.fragment&&(t.update(),E(t.before_update),t.fragment&&t.fragment.p(t.ctx,t.dirty),t.dirty=[-1],t.after_update.forEach(q))}const F=new Set;function J(t,e){-1===t.$$.dirty[0]&&(T.push(t),Y||(Y=!0,U.then(G)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function K(t,e,a,r,o,s,n=[-1]){const i=L;k(t);const d=e.props||{},l=t.$$={fragment:null,ctx:null,props:s,update:N,not_equal:o,bound:O(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:O(),dirty:n};let c=!1;var p,g,u;l.ctx=a?a(t,d,(e,a,r=a)=>(l.ctx&&o(l.ctx[e],l.ctx[e]=r)&&(l.bound[e]&&l.bound[e](r),c&&J(t,e)),a)):[],l.update(),c=!0,E(l.before_update),l.fragment=!!r&&r(l.ctx),e.target&&(e.hydrate?l.fragment&&l.fragment.l((u=e.target,Array.from(u.childNodes))):l.fragment&&l.fragment.c(),e.intro&&((p=t.$$.fragment)&&p.i&&(F.delete(p),p.i(g))),function(t,e,a){const{fragment:r,on_mount:o,on_destroy:s,after_update:n}=t.$$;r&&r.m(e,a),q(()=>{const e=o.map(I).filter(D);s?s.push(...e):E(e),t.$$.on_mount=[]}),n.forEach(q)}(t,e.target,e.anchor),G()),k(i)}class W{$destroy(){!function(t,e){const a=t.$$;null!==a.fragment&&(E(a.on_destroy),a.fragment&&a.fragment.d(e),a.on_destroy=a.fragment=null,a.ctx=[])}(this,1),this.$destroy=N}$on(t,e){const a=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return a.push(e),()=>{const t=a.indexOf(e);-1!==t&&a.splice(t,1)}}$set(){}}function X(t,e,a){let{name:r}=e;return t.$set=(t=>{"name"in t&&a(0,r=t.name)}),[r]}const Q=new class extends W{constructor(t){super(),K(this,t,X,null,M,{name:0})}}({target:document.body,props:{name:"World"}});return(()=>{let t,e,a,r,o={lines:9,length:4,width:5,radius:12,scale:1,corners:1,color:"#f40000",opacity:.25,rotate:0,direction:1,speed:1,trail:30,fps:20,zIndex:2e9,className:"spinner",shadow:!1,hwaccel:!1,position:"absolute"},s=document.getElementById("spinner");d3.select("#rounds-btn").on("click",function(){r=new Spinner(o).spin(s);var t=d3.select(this);"See Round 1"===t.text()?(i(e,"2019-11-10"),t.text("See Round 2")):(i(a,"2019-11-24"),t.text("See Round 1")),setTimeout(function(){r.stop()},1500)});const n=[d3.json("data/counties_bundle.json"),d3.csv("data/round1/pv_RO_PRSD_FINAL.csv"),d3.csv("data/round1/pv_SR_PRSD_FINAL.csv"),d3.csv("data/round1/pv_SR_PRSD-C_FINAL.csv"),d3.csv("data/round2/pv_RO_PRSD_FINAL.csv"),d3.csv("data/round2/pv_SR_PRSD_FINAL.csv"),d3.csv("data/round2/pv_SR_PRSD-C_FINAL.csv")];Promise.all(n).then(r=>{t=r[0];let o=r[1],s=r[2],n=r[3],d=r[4],l=r[5],c=r[6];n=x(n),c=x(c),e=[...o,...s,...n],a=[...d,...l,...c],i(a,"2019-11-24")}).catch(t=>console.log(t));const i=(e,a)=>{const r=y(t,e,a),o=(d3.select("#legend-percent").selectAll("*").remove(),d3.select("#legend-population").selectAll("*").remove(),d3.select("#geography").selectAll("*").remove(),d3.select("#gastner-c-cartogram").selectAll("*").remove(),d3.select("#gastner-g-cartogram").selectAll("*").remove(),d3.select("#dorling-cartogram").selectAll("*").remove(),d3.select("#demers-cartogram").selectAll("*").remove(),d3.select("#noncont-cartogram").selectAll("*").remove(),d3.select("#candidates-donut").selectAll("*").remove(),d3.select("#counties-treemap").selectAll("*").remove(),[d3.select("#legend-percent").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 150"),d3.select("#legend-population").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-20 20 620 660"),d3.select("#geography").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#gastner-c-cartogram").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#gastner-g-cartogram").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#dorling-cartogram").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#demers-cartogram").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#noncont-cartogram").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","-60 60 740 680"),d3.select("#candidates-donut").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 740 680"),d3.select("#counties-treemap").append("svg").attr("class","chart-group").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 620 660")]);let s,n,i,d,l,c,p,g,u,f;[s,n,i,d,l,c,p,g,u,f]=[...o],r(A,"counties_wgs84",s),r(j,"counties_wgs84",n),r(C,"counties_wgs84",i),r(C,"counties_cart_wgs84",d),r(C,"counties_cart_hex_10000_wgs84",l),r(R,"counties_wgs84",c),r(S,"counties_wgs84",p),r(w,"counties_wgs84",g),r(b,"counties_wgs84",i),r($,"counties_wgs84",u),r(_,"counties_wgs84",f)}}).call(void 0),Q}();
//# sourceMappingURL=bundle.js.map
